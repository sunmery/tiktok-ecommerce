syntax = "proto3";

package ecommerce.payment.v1;

import "google/api/annotations.proto";
import "google/protobuf/timestamp.proto";

option go_package = "backend/api/payment/v1;paymentv1";

service PaymentService {
  // 创建支付记录
  rpc CreatePayment(CreatePaymentReq) returns (PaymentResp) {
    option (google.api.http) = {
      post: "/v1/payments"
      body: "*"
    };
  }

  // 异步通知
  rpc PaymentNotify(PaymentNotifyReq) returns (PaymentNotifyResp) {
    option (google.api.http) = {
      post: "/v1/payments/notify"
      body: "*"
    };
  }

  // 支付宝回调
  rpc ProcessPaymentCallback(PaymentCallbackReq) returns (PaymentCallbackResp) {
    option (google.api.http) = {
      post: "/v1/payments/callback"
      body: "*"
    };
  }

  // 获取支付信息
  rpc GetPayment(GetPaymentReq) returns (PaymentResp) {
    option (google.api.http) = {
      get: "/v1/payments/{payment_id}"
    };
  }
}

message StringList {
  repeated string values = 1; // 表示 []string
}

message PaymentNotifyReq {
  map<string, StringList> values = 1;
}

message PaymentNotifyResp {
  string code = 1;
  string msg = 2;
}
message CreatePaymentReq {
  string order_id = 1;       // 主订单ID
  string currency = 2;       // 支付货币
  string amount = 3;         // 支付金额
  string payment_method = 4; // 支付方式
}

message PaymentResp {
  string payment_id = 1;
  string status = 2;         // CREATED/PENDING/SUCCEEDED/FAILED
  string payment_url = 3;    // 第三方支付链接
  google.protobuf.Timestamp created_at = 4;
}

message GetPaymentReq {
  string payment_id = 1;
}

message PaymentCallbackReq {
  string payment_id = 1;
  string status = 2;
  string gateway_response = 3; // 原始网关响应
  google.protobuf.Timestamp processed_at = 4;
  map<string, StringList> request_form = 5;
}

message PaymentCallbackResp {}
